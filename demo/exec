#!/usr/bin/env ruby
# frozen_string_literal: true

# Demonstrates executing external commands (like opening an editor).
# Ported from bubbletea/examples/exec

require "bundler/setup"
require "bubbletea"

class ExecDemo
  include Bubbletea::Model

  def initialize
    @altscreen_active = false
  end

  def init
    [self, nil]
  end

  def update(message)
    case message
    when Bubbletea::KeyMessage
      case message.to_s
      when "a"
        @altscreen_active = !@altscreen_active
        cmd = @altscreen_active ? Bubbletea.enter_alt_screen : Bubbletea.exit_alt_screen

        return [self, cmd]
      when "e"
        editor = ENV["EDITOR"] || "vim"
        return [self, Bubbletea.exec(-> { system(editor) })]
      when "ctrl+c", "q"
        return [self, Bubbletea.quit]
      end

    end

    [self, nil]
  end

  def view
    "Press 'e' to open your EDITOR.\nPress 'a' to toggle the altscreen\nPress 'q' to quit.\n"
  end
end

Bubbletea.run(ExecDemo.new)
